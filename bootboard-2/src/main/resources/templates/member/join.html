<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Sign Up</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
<div th:replace="~{header::header-fragment}"></div>
	<div class="container">  
		<h2>Sign Up</h2>
		<form th:action="@{/member/join}" method="post" 
			class="joinform" th:object="${memberDTO}">
			<fieldset>
				<ul>
					<li>
						<label for="memberId">아이디</label>
						<input type="text" th:field="*{memberId}" id="memberId"
								onblur="checkMemberId()">
						<p th:if="${#fields.hasErrors('memberId')}"
							th:errors="*{memberId}"></p> <!-- 에러문구 출력 -->
					</li>
					<li>
						<p id="check-result"></p>
					</li>
					<li>
						<label for="password">비밀번호</label>
						<input type="password" th:field="*{password}" id="password">
						<p th:if="${#fields.hasErrors('password')}"
							th:errors="*{password}"></p> <!-- 에러문구 출력 -->
					</li>
					<li>
						<label for="name">이름</label>
						<input type="text" th:field="*{name}" id="name">
						<p th:if="${#fields.hasErrors('name')}"
							th:errors="*{name}"></p> <!-- 에러문구 출력 -->
					</li>
					<li>
						<input type="submit" value="가입">
						<input type="reset" value="취소">
					</li>
				</ul>
			</fieldset>
		</form>
	</div>
<script>
	const checkEmail = () =>{
		//alert("text..");
		let inputEmail = document.getElementById("checkMemberId").value;
		let checkResult = document.getElementById("check-result");
		//console.log("입력된 이메일: " + inputEmail);
		
		$.ajax({
			type: "POST",
			url: "/member/check-email",
			//파라미터 : memberEmail
			data: {memberEmail: inputEmail},
			success: function(res){ //결과 문자열이 반환됨
				console.log("성공: ", res);
				if(res == "OK"){
					checkResult.innerHTML = "사용 가능한 이메일입니다."
					checkResult.style.color = "blue"
				}else{ //res == "NO"
					checkResult.innerHTML = "이미 등록된 이메일입니다."
						checkResult.style.color = "red"
				}
			},
			error: function(err){
				console.log("실패: ", err);
			}
		});
	};
	
</script>
<div th:replace="~{footer::footer-fragment}"></div>
</body>
</html>